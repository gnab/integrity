<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Capture</title>
  </head>
  <body>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script type="text/javascript">
      (function poll(){
        console.log('Waiting for tests...')
        $.ajax({ 
          url: '/run'
        , dataType: 'json'
        , timeout: 30000
        , success: function(test) {
            var result = eval(test.data);
            $.post('/result', JSON.stringify({id: test.id, result: result}),
              function success () {
                poll();
              });
          }
        , error: function (err) {
            if (err.statusText === 'timeout') {
              poll();
              return;
            }

            console.log('Unable to poll, make sure server is running.')
          }});
      })();  
    </script>
  </body>
</html>
